<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Certification Practice Tests</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-down { animation: slideDown 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.6s ease-out; }
        .option-hover:hover { transform: translateX(5px); }
        .cert-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }
        .cert-card:hover {
            transform: translateY(-16px) scale(1.03);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-600 via-purple-700 to-pink-600 min-h-screen">
    <div id="app" class="container mx-auto px-4 py-6 max-w-7xl"></div>

    <script>
        const certificationQuestions = {
            "AWS Certified Cloud Practitioner (CLF-C02)": [ /* your full 100+ questions here later */ ],
            "AWS Certified Solutions Architect – Associate (SAA-C03)": [ /* ... */ ],
            // ... other certifications
        };

        // Sample questions (replace with full banks later)
        Object.keys(certificationQuestions).forEach(key => {
            if (certificationQuestions[key].length === 0) {
                certificationQuestions[key] = [
                    { q: "Sample Question 1", options: ["A", "B", "C", "D"], answer: 1, explanation: "This is correct because..." },
                    { q: "Sample Question 2", options: ["A", "B", "C", "D"], answer: 2, explanation: "Explanation here" },
                    { q: "Sample Question 3", options: ["A", "B", "C", "D"], answer: 0, explanation: "Correct answer is A" }
                ];
            }
        });

        let selectedCert = null;
        let currentQuestions = [];
        let userAnswers = {};
        let stats = { correct: 0, wrong: 0, answered: 0 };
        let timeLeft = 130 * 60;
        let timerInterval = null;
        let timeUp = false;
        let reviewMode = false;

        // Local Storage Keys
        const STORAGE_KEY = 'aws-practice-progress';

        function saveProgress() {
            const progress = {
                selectedCert,
                currentQuestions,
                userAnswers,
                stats,
                timeLeft,
                timestamp: Date.now()
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));
        }

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) return false;
            const progress = JSON.parse(saved);
            // Auto-resume only if within 24 hours
            if (Date.now() - progress.timestamp > 24 * 60 * 60 * 1000) {
                localStorage.removeItem(STORAGE_KEY);
                return false;
            }
            selectedCert = progress.selectedCert;
            currentQuestions = progress.currentQuestions;
            userAnswers = progress.userAnswers;
            stats = progress.stats;
            timeLeft = progress.timeLeft;
            renderExamScreen();
            startTimer();
            alert(`Welcome back! Your progress for "${selectedCert}" has been restored.`);
            return true;
        }

        function clearProgress() {
            localStorage.removeItem(STORAGE_KEY);
        }

        function prepareQuestions(certKey) {
            const allQ = certificationQuestions[certKey];
            const shuffled = [...allQ].sort(() => 0.5 - Math.random());
            currentQuestions = shuffled.length >= 65 ? shuffled.slice(0, 65) : shuffled;
        }

        function startExam(certName) {
            selectedCert = certName;
            prepareQuestions(certName);
            userAnswers = {};
            stats = { correct: 0, wrong: 0, answered: 0 };
            timeLeft = 130 * 60;
            timeUp = false;
            reviewMode = false;
            clearProgress();
            renderExamScreen();
            startTimer();
        }

        function retryExam() {
            prepareQuestions(selectedCert);
            userAnswers = {};
            stats = { correct: 0, wrong: 0, answered: 0 };
            timeLeft = 130 * 60;
            timeUp = false;
            reviewMode = false;
            document.getElementById('resultModal').classList.add('hidden');
            renderExamScreen();
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                saveProgress();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp = true;
                    showResults();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            if (!document.getElementById('timer')) return;
            const m = String(Math.floor(timeLeft / 60)).padStart(2, '0');
            const s = String(timeLeft % 60).padStart(2, '0');
            document.getElementById('timer').textContent = `${m}:${s}`;
        }

        function selectAnswer(qIdx, optIdx) {
            if (timeUp || reviewMode || userAnswers[qIdx] !== undefined) return;
            const q = currentQuestions[qIdx];
            const correct = optIdx === q.answer;
            userAnswers[qIdx] = optIdx;
            stats.answered++;
            if (correct) stats.correct++;
            else stats.wrong++;
            renderQuestion(qIdx);
            updateStats();
            saveProgress();
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = stats.correct;
            document.getElementById('wrongCount').textContent = stats.wrong;
            const perc = stats.answered > 0 ? Math.round((stats.correct / stats.answered) * 100) : 0;
            document.getElementById('scorePercent').textContent = perc + '%';
            document.getElementById('progressText').textContent = stats.answered + '/' + currentQuestions.length;
            document.getElementById('progressFill').style.width = (stats.answered / currentQuestions.length) * 100 + '%';
        }

        function renderQuestion(idx) {
            const q = currentQuestions[idx];
            const ans = userAnswers[idx];
            const answered = ans !== undefined;
            const correct = answered && ans === q.answer;

            const el = document.getElementById(`question-${idx}`);
            let optionsHTML = '';
            q.options.forEach((opt, i) => {
                const selected = ans === i;
                const isCorrect = q.answer === i;
                let btnClass = 'w-full p-5 rounded-xl transition-all flex items-center gap-4 text-left border-2 ';
                if (reviewMode || timeUp) {
                    if (isCorrect) btnClass += 'border-green-500 bg-green-50';
                    else if (selected && !isCorrect) btnClass += 'border-red-500 bg-red-50';
                    else btnClass += 'border-gray-200 bg-gray-50 opacity-60';
                } else if (answered) {
                    if (isCorrect) btnClass += 'border-green-500 bg-green-50 cursor-not-allowed';
                    else if (selected) btnClass += 'border-red-500 bg-red-50 cursor-not-allowed';
                    else btnClass += 'border-gray-200 bg-gray-50 opacity-60 cursor-not-allowed';
                } else {
                    btnClass += 'border-gray-200 bg-gray-50 hover:border-purple-500 hover:bg-purple-50 cursor-pointer option-hover';
                }

                const labelCls = (reviewMode || timeUp) && isCorrect ? 'bg-green-600' : (reviewMode || timeUp) && selected && !isCorrect ? 'bg-red-600' : 'bg-purple-600';
                const icon = (reviewMode || timeUp) && isCorrect ? 'Correct' :
                             (reviewMode || timeUp) && selected && !isCorrect ? 'Incorrect' : '';

                optionsHTML += `<button ${!reviewMode && !timeUp && !answered ? `onclick="selectAnswer(${idx},${i})"` : ''} class="${btnClass}" ${reviewMode || timeUp || answered ? 'disabled' : ''}>
                    <div class="w-11 h-11 rounded-full flex items-center justify-center font-bold text-white text-lg ${labelCls}">${String.fromCharCode(65+i)}</div>
                    <span class="text-gray-800 text-lg flex-1">${opt}</span>
                    ${icon ? `<span class="ml-auto font-bold text-${isCorrect ? 'green' : 'red'}-600">${icon}</span>` : ''}
                </button>`;
            });

            let expl = '';
            if (answered || reviewMode || timeUp) {
                const color = correct ? 'green' : 'red';
                expl = `<div class="mt-6 p-6 rounded-xl border-l-4 bg-${color}-50 border-${color}-500 animate-slide-down">
                    <p class="mb-2 font-semibold text-${color}-700">${correct ? 'Correct Answer' : 'Incorrect'} → ${String.fromCharCode(65+q.answer)}) ${q.options[q.answer]}</p>
                    <p><strong>Explanation:</strong> ${q.explanation}</p>
                </div>`;
            }

            el.innerHTML = `
                <div class="flex items-start gap-5 mb-6">
                    <div class="w-14 h-14 rounded-full ${correct ? 'bg-green-500' : answered ? 'bg-red-500' : 'bg-gradient-to-br from-purple-600 to-indigo-700'} text-white flex items-center justify-center font-bold text-xl flex-shrink-0">
                        ${idx+1}
                    </div>
                    <h3 class="text-xl font-semibold text-gray-800 leading-relaxed">${q.q}</h3>
                </div>
                <div class="space-y-4">${optionsHTML}</div>
                ${expl}
            `;
        }

        function renderAllQuestions() {
            const cont = document.getElementById('questionsContainer');
            cont.innerHTML = '';
            currentQuestions.forEach((_, i) => {
                const div = document.createElement('div');
                div.id = `question-${i}`;
                div.className = 'bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl transition-shadow';
                cont.appendChild(div);
                renderQuestion(i);
            });
        }

        function showResults() {
            clearInterval(timerInterval);
            reviewMode = true;
            renderAllQuestions(); // Show all answers

            const percentage = Math.round((stats.correct / currentQuestions.length) * 100);
            const scaledScore = Math.round((stats.correct / currentQuestions.length) * 300 + 700); // AWS scale: 700–1000

            document.getElementById('finalScore').textContent = percentage + '%';
            document.getElementById('scaledScore').textContent = scaledScore;
            document.getElementById('finalCorrect').textContent = stats.correct;
            document.getElementById('finalWrong').textContent = currentQuestions.length - stats.correct;
            document.getElementById('passStatus').textContent = scaledScore >= 720 ? 'PASSED' : 'FAILED';
            document.getElementById('passStatus').className = scaledScore >= 720 ? 'text-green-600' : 'text-red-600';

            document.getElementById('resultModal').classList.remove('hidden');
            document.getElementById('resultModal').classList.add('flex');
        }

        function backToHome() {
            clearInterval(timerInterval);
            clearProgress();
            document.getElementById('app').innerHTML = getHomeHTML();
        }

        function renderExamScreen() {
            document.getElementById('app').innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-4xl font-bold text-purple-700">${selectedCert}</h1>
                        <button onclick="backToHome()" class="text-purple-600 hover:underline text-lg font-medium">Back to Certifications</button>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-5">
                        <div class="bg-gradient-to-br from-purple-600 to-indigo-700 text-white p-5 rounded-xl text-center"><div class="text-3xl font-bold">${currentQuestions.length}</div><div class="text-sm opacity-90">Questions</div></div>
                        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-5 rounded-xl text-center"><div class="text-3xl font-bold" id="correctCount">0</div><div class="text-sm opacity-90">Correct</div></div>
                        <div class="bg-gradient-to-br from-red-500 to-red-600 text-white p-5 rounded-xl text-center"><div class="text-3xl font-bold" id="wrongCount">0</div><div class="text-sm opacity-90">Wrong</div></div>
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-5 rounded-xl text-center"><div class="text-3xl font-bold" id="scorePercent">0%</div><div class="text-sm opacity-90">Score</div></div>
                        <div class="bg-gradient-to-br from-yellow-500 to-orange-600 text-white p-5 rounded-xl text-center"><div class="text-3xl font-bold" id="timer">130:00</div><div class="text-sm opacity-90">Time Left</div></div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex justify-between mb-3 text-gray-700 font-semibold"><span>Progress</span><span id="progressText">0/${currentQuestions.length}</span></div>
                    <div class="h-6 bg-gray-200 rounded-full overflow-hidden"><div id="progressFill" class="h-full bg-gradient-to-r from-purple-600 to-indigo-700 transition-all duration-500" style="width:0%"></div></div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6 mb-10 flex flex-wrap gap-5">
                    <button onclick="scrollToNextUnanswered()" class="flex-1 bg-purple-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-purple-700 transition-all text-lg">Next Unanswered</button>
                    <button onclick="showResults()" class="flex-1 bg-green-600 text-white px-8 py-4 rounded-xl font-bold hover:bg-green-700 transition-all text-lg">Submit & Review</button>
                </div>

                <div id="questionsContainer" class="space-y-10"></div>

                <!-- Result Modal with Scaled Score + Review -->
                <div id="resultModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-3xl p-12 max-w-2xl w-full text-center shadow-2xl animate-slide-up">
                        <h2 class="text-5xl font-bold text-purple-700 mb-6">Exam Completed!</h2>
                        <div class="text-9xl font-bold bg-gradient-to-r from-purple-600 to-indigo-700 bg-clip-text text-transparent mb-4" id="finalScore">0%</div>
                        <div class="text-6xl font-bold mb-8" id="scaledScore">0</div>
                        <div class="text-5xl font-bold mb-8" id="passStatus">PENDING</div>
                        <div class="text-xl text-gray-600 mb-10">Passing Score: 720/1000</div>

                        <div class="grid grid-cols-2 gap-10 mb-12">
                            <div class="bg-green-50 p-8 rounded-3xl"><div class="text-6xl font-bold text-green-600" id="finalCorrect">0</div><div class="text-gray-600 text-xl mt-2">Correct</div></div>
                            <div class="bg-red-50 p-8 rounded-3xl"><div class="text-6xl font-bold text-red-600" id="finalWrong">0</div><div class="text-gray-600 text-xl mt-2">Wrong</div></div>
                        </div>

                        <div class="space-y-4">
                            <button onclick="retryExam()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-700 text-white text-xl py-5 rounded-xl font-bold hover:opacity-90 transition-all">
                                Retry This Exam
                            </button>
                            <button onclick="backToHome()" class="w-full bg-gray-600 text-white text-xl py-5 rounded-xl font-bold hover:bg-gray-700 transition-all">
                                Choose Another Certification
                            </button>
                        </div>
                    </div>
                </div>
            `;
            renderAllQuestions();
            updateStats();
        }

        function scrollToNextUnanswered() {
            for (let i = 0; i < currentQuestions.length; i++) {
                if (userAnswers[i] === undefined) {
                    document.getElementById(`question-${i}`).scrollIntoView({ behavior: 'smooth', block: 'center' });
                    return;
                }
            }
        }

        function getHomeHTML() {
            return `
                <div class="text-center py-16">
                    <h1 class="text-6xl md:text-7xl font-bold text-white mb-6 drop-shadow-2xl">AWS Certification Practice Tests</h1>
                    <p class="text-2xl md:text-3xl text-purple-100 mb-20 max-w-4xl mx-auto">Real exam experience • 130-minute timer • 720/1000 passing score • Progress saved automatically</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-12 max-w-7xl mx-auto px-6">
                        ${Object.keys(certificationQuestions).map(cert => `
                            <div onclick="startExam('${cert}')" class="cert-card bg-white/95 backdrop-blur rounded-3xl shadow-2xl p-10 text-center group">
                                <div class="w-28 h-28 mx-auto mb-8 bg-gradient-to-br from-purple-600 to-indigo-700 rounded-3xl flex items-center justify-center group-hover:scale-110 transition-transform">
                                    <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5z"/>
                                    </svg>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-2">${cert.split(' (')[0]}</h3>
                                <p class="text-purple-600 font-bold text-xl mb-6">${cert.match(/\((.*?)\)/)[0]}</p>
                                <div class="text-purple-600 font-bold text-xl opacity-0 group-hover:opacity-100 transition-opacity">
                                    Start Practice
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // On load: Try to resume previous session
        window.onload = () => {
            if (!loadProgress()) {
                document.getElementById('app').innerHTML = getHomeHTML();
            }
        };
    </script>
</body>
</html>
